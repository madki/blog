<!DOCTYPE html>
<html>
<head>
    <!-- [[! Document Settings ]] -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- [[! Page Meta ]] -->
    <title>AutoIntent</title>
    <meta name="description" content="Stray thoughts & keystrokes - Web log of various coding experiments and attempts" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/blog/assets/images/favicon.ico" >

    <!-- [[! Styles'n'Scripts ]] -->
    <link rel="stylesheet" type="text/css" href="/blog/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css"
          href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/blog/assets/css/syntax.css" />
    
    <!-- [[! Ghost outputs important style and meta data with this tag ]] -->
        <link rel="canonical" href="/blog/" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/blog/page2/" />

    <meta property="og:site_name" content="Stray thoughts & keystrokes" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Stray thoughts & keystrokes" />
    <meta property="og:description" content="Web log of various coding experiments and attempts" />
    <meta property="og:url" content="/blog/" />
    <meta property="og:image" content="/blog/assets/images/cover1.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Stray thoughts & keystrokes" />
    <meta name="twitter:description" content="Web log of various coding experiments and attempts" />
    <meta name="twitter:url" content="/blog/" />
    <meta name="twitter:image:src" content="/blog/assets/images/cover1.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Finding The Way Home",
    "url": "/blog/",
    "image": "/blog/assets/images/cover1.jpg",
    "description": "Web log of various coding experiments and attempts"
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Stray thoughts & keystrokes" href="/blog/rss.xml" />

</head>
<body class="post-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/blog/">Home</a></li>
        <li class="nav-bundler " role="presentation"><a href="/blog/tag/bundler">Bundler</a></li>
        <li class="nav-author " role="presentation"><a href="/blog/author/madki">Author</a></li>
        <li class="nav-portfolio " role="presentation"><a href="http://madki.xyz/portfolio">Portfolio</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/blog/rss.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>

    <div class="site-wrapper">

        <!-- [[! Everything else gets inserted here ]] -->
        <!-- < default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="blog-logo" href="/blog/"><img src="/blog/assets/images/ghost.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-bundler">

        <header class="post-header">
            <h1 class="post-title">AutoIntent</h1>
            <section class="post-meta">
            <!-- <a href='/blog/'>Madhu kiran</a> -->
            <time class="post-date" datetime="2016-02-06">06 Feb 2016</time>
                <!-- [[tags prefix=" on "]] -->
                 
                on 
                
                    
                       <a href='/blog/tag/bundler'>Bundler</a>
                       
                
                
            </section>
        </header>

        <section class="post-content">
            
            <h2>The problem</h2>

<p>Data transfer in android happens a lot via intents. Even in case of single activity pattern (to which square is a strong proponent of) there are still Android&#39;s system activities that are needed to be started or passing messages to services. So intents are probably going to stay for a while and if there&#39;s a way to make them better it&#39;s worth taking a look at.</p>

<ul>
<li><p><strong>Type-safety</strong> One of the advantages Intents offer is the completely decoupling of the calling code and the recieving activity. It has one major caveat that compilers are now clueless whether the passed in values are correct. Any key can be mapped with any of the types that can be put into the intent.</p></li>
<li><p><strong>Definition</strong> There&#39;s no standard way to specify intent requirements. Some activities need some additional extras that are required for it to start. In some cases additional flags or action might have to be set. There should be an easier and straight forward way of defining these requirements such that misuse can be avoided or spotted on the calling side (compile time errors or fail-fast: during execution of calling code)</p></li>
</ul>

<p>These happen to be the major problems with intents. </p>

<h2>The ideal solution</h2>

<p>The ideal solution for this problem is to write wrappers for all intents and expose helpers/builders for starting activities. But the amount of code actually needed for this is very huge. A sample <code>DemoActivity</code> with three extras two of which are definitely required(<code>id</code> and <code>name</code>) will look as follows:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemoActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ID</span>     <span class="o">=</span> <span class="s">&quot;DemoActivity#id&quot;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">NAME</span>   <span class="o">=</span> <span class="s">&quot;DemoActivity#name&quot;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">GENDER</span> <span class="o">=</span> <span class="s">&quot;DemoActivity#gender&quot;</span><span class="o">;</span>


    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Parser</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">;</span>

        <span class="kd">private</span> <span class="nf">Parser</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">intent</span> <span class="o">=</span> <span class="n">intent</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">int</span> <span class="nf">id</span><span class="o">(</span><span class="kt">int</span> <span class="n">defValue</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">intent</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="n">defValue</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">intent</span><span class="o">.</span><span class="na">getIntExtra</span><span class="o">(</span><span class="n">ID</span><span class="o">,</span> <span class="n">defValue</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kt">int</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">intent</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="n">NAME</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// @TypeDef support annotation</span>
        <span class="nd">@Gender</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="nf">gender</span><span class="o">(</span><span class="kt">int</span> <span class="n">defValue</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">intent</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="n">defValue</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">intent</span><span class="o">.</span><span class="na">getIntExtra</span><span class="o">(</span><span class="n">GENDER</span><span class="o">,</span> <span class="n">defValue</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
        <span class="nd">@Gender</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">gender</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Builder</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">Builder</span> <span class="nf">gender</span><span class="o">(</span><span class="nd">@Gender</span> <span class="kt">int</span> <span class="n">g</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">gender</span> <span class="o">=</span> <span class="n">g</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">Intent</span> <span class="nf">intent</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">DemoActivity</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">ID</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">NAME</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">GENDER</span><span class="o">,</span> <span class="n">gender</span><span class="o">);</span>
        <span class="o">}</span> 

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">context</span><span class="o">.</span><span class="na">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">(</span><span class="n">context</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>As can be seen this quickly gets verbose with null checks and changing one field leads to additional changes in multiple places, maintainability becomes hard.</p>

<h2>Annotation processing to rescue</h2>

<p>The repeated code in the above can be generated by an annotation processor. Opting for a definition structure very similar to <code>AutoValue</code>. The code could look like:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemoActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedState</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// DemoActivity_Extras is the generated class</span>
        <span class="n">Extras</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">DemoActivity_Extras</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span> 

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Builder</span> <span class="nf">withExtras</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// DemoActivity_Builder is the generated class</span>
        <span class="c1">// all non-optional parameters are taken in constructor</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DemoActivity_Builder</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>   

    <span class="c1">// generated DemoActivity_Extras</span>
    <span class="nd">@Args</span><span class="o">(</span><span class="n">DemoActivity</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">static</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Extras</span> <span class="o">{</span>
        <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">int</span> <span class="nf">id</span><span class="o">();</span>
        <span class="kd">protected</span> <span class="kd">abstract</span> <span class="n">String</span> <span class="nf">name</span><span class="o">();</span>

        <span class="nd">@Optional</span> <span class="nd">@Gender</span>
        <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">int</span> <span class="nf">gender</span><span class="o">(</span><span class="kt">int</span> <span class="n">defValue</span><span class="o">);</span>

        <span class="c1">// methods to check if the extra was passed in the intent</span>
        <span class="nd">@Helpers</span>
        <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">boolean</span> <span class="nf">hasId</span><span class="o">();</span>
        <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">boolean</span> <span class="nf">hasName</span><span class="o">();</span>
        <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">boolean</span> <span class="nf">hasGender</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// This is optional</span>
    <span class="c1">// the info above given by @Extras is enough</span>
    <span class="c1">// to generate DemoActivity_Builder</span>
    <span class="nd">@ArgFactory</span><span class="o">(</span><span class="n">DemoActivity</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">interface</span> <span class="nc">Builder</span> <span class="o">{</span>
        <span class="n">Builder</span> <span class="nf">gender</span><span class="o">(</span><span class="nd">@Gender</span> <span class="kt">int</span> <span class="n">gender</span><span class="o">);</span>

        <span class="n">Intent</span> <span class="nf">intent</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">);</span>
        <span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">);</span>
        <span class="kt">void</span> <span class="nf">startActivityForResult</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kt">int</span> <span class="n">requestCode</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>Now this activity can be started from the calling code in a very clean way:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DemoActivity</span><span class="o">.</span><span class="na">withExtras</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">&quot;Name&quot;</span><span class="o">)</span>
            <span class="o">.</span><span class="na">gender</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
            <span class="o">.</span><span class="na">start</span><span class="o">();</span>
</code></pre></div>
<p>Compiler knows what the activity needs to start now. We get awesome autocompletion and the completion would suggest us the required fields and the optional ones. Notice the absence of intent key definitions. The keys can also be generated and if some of the extras need to have a partcular key, it can be provided with a <code>@Key</code> annotation.</p>

<p>The same method can be used for generating <code>Builder</code>s for activities that use Intents with uris or action and data. The code in the above class can further be reduced. Once the optional parameters are declared with <code>@Optional</code> the <code>Builder</code> can actually be generated without the interface. </p>

<p>There is no need for both <code>@Args</code> and <code>@ArgFactory</code> to be defined as inner classes of Activity. So these annotations could be used for generating type safe wrappers for any existing activities (from other libraries or core android activities).</p>

<p>I have already made an attempt in this direction once and made the <a href="https://github.com/workarounds/bundler">Bundler library</a>. It&#39;s actually simpler to use but it has many issues that I discovered while using and it heavily exposes the generated classes which turned out to be a very bad idea (no surprises there).</p>

<p>I&#39;d like to inputs and would appreciate any advice and suggestions in re-doing the library (or starting a new one) with a better api and more focus. </p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->

            
            <figure class="author-image">
                <a class="img" href="/blog/author/madki" style="background-image: url(/blog/assets/images/madhukiran.jpg)"><span class="hidden">'s Picture</span></a>
            </figure>
            

            <section class="author">
                <h4><a href="/blog/author/madki">Madhu kiran</a></h4>
                
                
                    <p> Believes coding is a form of creative expression.</p>
                
                <div class="author-meta">
                    <span class="author-location icon-location"> Some City, India</span> 
                    <span class="author-link icon-link"><a href="http://madki.xyz"> madki.xyz</a></span> 
                </div>
            </section>

            <!-- /author  -->

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=AutoIntent&amp;url=http://madki.xyzauto-intent"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://madki.xyzauto-intent"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://madki.xyzauto-intent"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
            
            <!-- Add Disqus Comments -->
            
            
        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev no-cover" href="/blog/interface-vs-abstract-class">
            <section class="post">
                <h2>Interface vs abstract class for `@Args`</h2>
                <p>Having decided defining the @Args are better off by not being fields. Having an inner...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/blog/">Stray thoughts & keystrokes</a> &copy; 2016</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/biomadeira/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- [[! Ghost outputs important scripts and data with this tag ]] -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <!-- [[! The main JavaScript file for Casper ]] -->
    <script type="text/javascript" src="/blog/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/blog/assets/js/index.js"></script>

    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-73781008-1', 'auto');
	    ga('send', 'pageview');

     </script>   
</body>
</html>
